<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>图片弯曲成环状效果</title>
    <style>
        canvas { border: 1px solid #ccc; margin: 10px; }
        .controls { margin: 10px; padding: 10px; border: 1px solid #eee; }
        label { display: inline-block; width: 150px; }
        input { width: 100px; margin: 5px; }
    </style>
</head>
<body>
<div class="controls">
    <label for="innerRatio">内环比例 (0-1):</label>
    <input type="range" id="innerRatio" min="0" max="0.99" step="0.01" value="0.5">
    <span id="innerRatioValue">0.5</span><br>

    <label for="angleRange">显示角度 (度):</label>
    <input type="range" id="angleRange" min="0" max="360" step="1" value="360">
    <span id="angleRangeValue">360</span><br>

    <button onclick="processImage()">生成环状效果</button>
</div>

<div>
    <canvas id="originalCanvas" width="200" height="200"></canvas>
    <canvas id="ringCanvas" width="400" height="400"></canvas>
</div>

<script>
  // 获取Canvas和上下文
  const originalCanvas = document.getElementById('originalCanvas');
  const originalCtx = originalCanvas.getContext('2d');
  const ringCanvas = document.getElementById('ringCanvas');
  const ringCtx = ringCanvas.getContext('2d');

  // 获取控制元素
  const innerRatioSlider = document.getElementById('innerRatio');
  const innerRatioValue = document.getElementById('innerRatioValue');
  const angleRangeSlider = document.getElementById('angleRange');
  const angleRangeValue = document.getElementById('angleRangeValue');

  // 更新滑块值显示
  innerRatioSlider.oninput = function() { innerRatioValue.textContent = this.value; };
  angleRangeSlider.oninput = function() { angleRangeValue.textContent = this.value; };

  // 创建示例图片（白色到红色的渐变）
  function createSampleImage() {
    const gradient = originalCtx.createLinearGradient(0, 0, originalCanvas.width, 0);
    gradient.addColorStop(0, 'white');
    gradient.addColorStop(1, 'red');

    originalCtx.fillStyle = gradient;
    originalCtx.fillRect(0, 0, originalCanvas.width, originalCanvas.height);

    // 添加一些文本便于观察变形效果
    originalCtx.fillStyle = 'blue';
    originalCtx.font = '20px Arial';
    originalCtx.fillText('变形测试', 30, 100);
  }

  // 将图片弯曲成环状
  function warpImageToRing(innerRatio, angleRange) {
    const centerX = ringCanvas.width / 2;
    const centerY = ringCanvas.height / 2;
    const outerRadius = Math.min(centerX, centerY) * 0.9;
    const innerRadius = outerRadius * innerRatio;
    const angleRangeRad = angleRange * Math.PI / 180;

    // 清空画布
    ringCtx.clearRect(0, 0, ringCanvas.width, ringCanvas.height);

    // 获取原始图片数据
    const imageData = originalCtx.getImageData(0, 0, originalCanvas.width, originalCanvas.height);
    const data = imageData.data;

    // 环状效果绘制
    for (let y = 0; y < originalCanvas.height; y++) {
      for (let x = 0; x < originalCanvas.width; x++) {
        // 计算对应的角度和半径
        const angle = (x / originalCanvas.width) * angleRangeRad;
        const radius = innerRadius + (y / originalCanvas.height) * (outerRadius - innerRadius);

        // 计算环状坐标
        const ringX = centerX + Math.cos(angle) * radius;
        const ringY = centerY + Math.sin(angle) * radius;

        // 获取原始像素颜色
        const index = (y * originalCanvas.width + x) * 4;
        const r = data[index];
        const g = data[index + 1];
        const b = data[index + 2];
        const a = data[index + 3];

        // 在环状画布上绘制像素
        ringCtx.fillStyle = `rgba(${r}, ${g}, ${b}, ${a/255})`;
        ringCtx.fillRect(ringX, ringY, 1, 1);
      }
    }
  }

  // 处理图片
  function processImage() {
    const innerRatio = parseFloat(innerRatioSlider.value);
    const angleRange = parseFloat(angleRangeSlider.value);

    warpImageToRing(innerRatio, angleRange);
  }

  // 初始化
  createSampleImage();
  processImage();
</script>
</body>
</html>
